#!/usr/bin/env tsx

import { getFeatureFlags } from '../src/lib/feature-flags'

async function checkAnalyticsLoggingSystem() {
  console.log('üìä Checking Analytics & Logging System...\n')
  
  const flags = getFeatureFlags()
  
  console.log('üìä ANALYTICS & LOGGING SYSTEM STATUS:')
  console.log(`   Analytics Feature Enabled: ${flags.analytics ? '‚úÖ' : '‚ùå'}`)
  console.log(`   Notifications Feature Enabled: ${flags.notifications ? '‚úÖ' : '‚ùå'}`)
  console.log('')
  
  // Check analytics/logging-related files
  const analyticsFiles = [
    'src/hooks/useAnalytics.ts',
    'src/hooks/useErrorMonitoring.ts',
    'src/hooks/useLogging.ts',
    'src/app/api/analytics/track/route.ts',
    'src/app/api/monitoring/error/route.ts',
    'src/app/api/logging/log/route.ts',
    'src/lib/analytics.ts',
  ]
  
  console.log('üìÅ ANALYTICS & LOGGING FILES CHECK:')
  const fs = require('fs')
  const path = require('path')
  
  for (const file of analyticsFiles) {
    const filePath = path.join(process.cwd(), file)
    const exists = fs.existsSync(filePath)
    console.log(`   ${exists ? '‚úÖ' : '‚ùå'} ${file}`)
  }
  console.log('')
  
  // Check Google Analytics integration
  console.log('üîç GOOGLE ANALYTICS INTEGRATION:')
  try {
    const layoutContent = fs.readFileSync(path.join(process.cwd(), 'src/app/[locale]/layout.tsx'), 'utf-8')
    
    const hasGoogleAnalytics = layoutContent.includes('GOOGLE_ANALYTICS_ID')
    const hasGtagScript = layoutContent.includes('gtag')
    const hasAnalyticsScript = layoutContent.includes('googletagmanager')
    
    console.log(`   ${hasGoogleAnalytics ? '‚úÖ' : '‚ùå'} Google Analytics ID configuration`)
    console.log(`   ${hasGtagScript ? '‚úÖ' : '‚ùå'} Gtag script integration`)
    console.log(`   ${hasAnalyticsScript ? '‚úÖ' : '‚ùå'} Google Tag Manager script`)
  } catch (error) {
    console.log('   ‚ùå Layout file not found')
  }
  
  // Check analytics library
  try {
    const analyticsContent = fs.readFileSync(path.join(process.cwd(), 'src/lib/analytics.ts'), 'utf-8')
    
    const hasTrackingFunctions = analyticsContent.includes('trackEvent')
    const hasPageViewTracking = analyticsContent.includes('trackPageView')
    const hasConversionTracking = analyticsContent.includes('trackConversion')
    const hasUserTracking = analyticsContent.includes('setUserId')
    const hasEcommerceTracking = analyticsContent.includes('trackPurchase')
    
    console.log(`   ${hasTrackingFunctions ? '‚úÖ' : '‚ùå'} Event tracking functions`)
    console.log(`   ${hasPageViewTracking ? '‚úÖ' : '‚ùå'} Page view tracking`)
    console.log(`   ${hasConversionTracking ? '‚úÖ' : '‚ùå'} Conversion tracking`)
    console.log(`   ${hasUserTracking ? '‚úÖ' : '‚ùå'} User ID tracking`)
    console.log(`   ${hasEcommerceTracking ? '‚úÖ' : '‚ùå'} E-commerce tracking`)
  } catch (error) {
    console.log('   ‚ùå Analytics library not found')
  }
  console.log('')
  
  // Check analytics hooks
  console.log('üé£ ANALYTICS HOOKS:')
  try {
    const useAnalyticsContent = fs.readFileSync(path.join(process.cwd(), 'src/hooks/useAnalytics.ts'), 'utf-8')
    
    const hasPageViewTracking = useAnalyticsContent.includes('trackPageView')
    const hasEventTracking = useAnalyticsContent.includes('trackEvent')
    const hasInteractionTracking = useAnalyticsContent.includes('trackInteraction')
    const hasFormTracking = useAnalyticsContent.includes('trackFormSubmission')
    const hasConversionTracking = useAnalyticsContent.includes('trackConversion')
    const hasErrorTracking = useAnalyticsContent.includes('trackError')
    const hasPerformanceTracking = useAnalyticsContent.includes('trackPerformance')
    const hasAIUsageTracking = useAnalyticsContent.includes('trackAIUsage')
    const hasSubscriptionTracking = useAnalyticsContent.includes('trackSubscription')
    const hasUserProperties = useAnalyticsContent.includes('setUserProperties')
    
    console.log(`   ${hasPageViewTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Page view tracking`)
    console.log(`   ${hasEventTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Event tracking`)
    console.log(`   ${hasInteractionTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Interaction tracking`)
    console.log(`   ${hasFormTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Form submission tracking`)
    console.log(`   ${hasConversionTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Conversion tracking`)
    console.log(`   ${hasErrorTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Error tracking`)
    console.log(`   ${hasPerformanceTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Performance tracking`)
    console.log(`   ${hasAIUsageTracking ? '‚úÖ' : '‚ùå'} useAnalytics: AI usage tracking`)
    console.log(`   ${hasSubscriptionTracking ? '‚úÖ' : '‚ùå'} useAnalytics: Subscription tracking`)
    console.log(`   ${hasUserProperties ? '‚úÖ' : '‚ùå'} useAnalytics: User properties`)
  } catch (error) {
    console.log('   ‚ùå useAnalytics hook not found')
  }
  console.log('')
  
  // Check error monitoring
  console.log('üö® ERROR MONITORING:')
  try {
    const errorMonitoringContent = fs.readFileSync(path.join(process.cwd(), 'src/hooks/useErrorMonitoring.ts'), 'utf-8')
    
    const hasGlobalErrorHandler = errorMonitoringContent.includes('handleGlobalError')
    const hasPromiseRejectionHandler = errorMonitoringContent.includes('handleUnhandledRejection')
    const hasNetworkErrorHandler = errorMonitoringContent.includes('handleNetworkError')
    const hasCustomErrorLogging = errorMonitoringContent.includes('logError')
    const hasAPIErrorLogging = errorMonitoringContent.includes('logAPIError')
    const hasReactErrorLogging = errorMonitoringContent.includes('logReactError')
    const hasValidationErrorLogging = errorMonitoringContent.includes('logValidationError')
    const hasErrorStats = errorMonitoringContent.includes('getErrorStats')
    const hasErrorBoundary = errorMonitoringContent.includes('useErrorBoundary')
    
    console.log(`   ${hasGlobalErrorHandler ? '‚úÖ' : '‚ùå'} Global error handler`)
    console.log(`   ${hasPromiseRejectionHandler ? '‚úÖ' : '‚ùå'} Promise rejection handler`)
    console.log(`   ${hasNetworkErrorHandler ? '‚úÖ' : '‚ùå'} Network error handler`)
    console.log(`   ${hasCustomErrorLogging ? '‚úÖ' : '‚ùå'} Custom error logging`)
    console.log(`   ${hasAPIErrorLogging ? '‚úÖ' : '‚ùå'} API error logging`)
    console.log(`   ${hasReactErrorLogging ? '‚úÖ' : '‚ùå'} React error logging`)
    console.log(`   ${hasValidationErrorLogging ? '‚úÖ' : '‚ùå'} Validation error logging`)
    console.log(`   ${hasErrorStats ? '‚úÖ' : '‚ùå'} Error statistics`)
    console.log(`   ${hasErrorBoundary ? '‚úÖ' : '‚ùå'} Error boundary hook`)
  } catch (error) {
    console.log('   ‚ùå Error monitoring hook not found')
  }
  console.log('')
  
  // Check logging system
  console.log('üìù LOGGING SYSTEM:')
  try {
    const loggingContent = fs.readFileSync(path.join(process.cwd(), 'src/hooks/useLogging.ts'), 'utf-8')
    
    const hasLogLevels = loggingContent.includes('debug') && loggingContent.includes('info') && loggingContent.includes('warn') && loggingContent.includes('error')
    const hasUserActionLogging = loggingContent.includes('logUserAction')
    const hasAPILogging = loggingContent.includes('logAPICall')
    const hasPerformanceLogging = loggingContent.includes('logPerformance')
    const hasSecurityLogging = loggingContent.includes('logSecurity')
    const hasBusinessLogging = loggingContent.includes('logBusiness')
    const hasLogFiltering = loggingContent.includes('getLogsByLevel')
    const hasLogSearch = loggingContent.includes('searchLogs')
    const hasLogStats = loggingContent.includes('getLogStats')
    const hasLogExport = loggingContent.includes('exportLogs')
    const hasRemoteLogging = loggingContent.includes('sendLogToRemote')
    const hasStorageLogging = loggingContent.includes('saveLogToStorage')
    
    console.log(`   ${hasLogLevels ? '‚úÖ' : '‚ùå'} Log levels (debug, info, warn, error)`)
    console.log(`   ${hasUserActionLogging ? '‚úÖ' : '‚ùå'} User action logging`)
    console.log(`   ${hasAPILogging ? '‚úÖ' : '‚ùå'} API call logging`)
    console.log(`   ${hasPerformanceLogging ? '‚úÖ' : '‚ùå'} Performance logging`)
    console.log(`   ${hasSecurityLogging ? '‚úÖ' : '‚ùå'} Security logging`)
    console.log(`   ${hasBusinessLogging ? '‚úÖ' : '‚ùå'} Business event logging`)
    console.log(`   ${hasLogFiltering ? '‚úÖ' : '‚ùå'} Log filtering`)
    console.log(`   ${hasLogSearch ? '‚úÖ' : '‚ùå'} Log search`)
    console.log(`   ${hasLogStats ? '‚úÖ' : '‚ùå'} Log statistics`)
    console.log(`   ${hasLogExport ? '‚úÖ' : '‚ùå'} Log export`)
    console.log(`   ${hasRemoteLogging ? '‚úÖ' : '‚ùå'} Remote logging`)
    console.log(`   ${hasStorageLogging ? '‚úÖ' : '‚ùå'} Local storage logging`)
  } catch (error) {
    console.log('   ‚ùå Logging hook not found')
  }
  console.log('')
  
  // Check API routes
  console.log('üîå API ROUTES:')
  const apiRoutes = [
    'src/app/api/analytics/track/route.ts',
    'src/app/api/monitoring/error/route.ts',
    'src/app/api/logging/log/route.ts',
  ]
  
  for (const route of apiRoutes) {
    const routePath = path.join(process.cwd(), route)
    const exists = fs.existsSync(routePath)
    console.log(`   ${exists ? '‚úÖ' : '‚ùå'} ${route}`)
  }
  console.log('')
  
  // Check environment variables
  console.log('üîß ANALYTICS & LOGGING ENVIRONMENT:')
  const analyticsEnvVars = [
    'NEXT_PUBLIC_GOOGLE_ANALYTICS_ID',
    'NEXT_PUBLIC_FEATURE_ANALYTICS',
    'NEXT_PUBLIC_FEATURE_NOTIFICATIONS',
  ]
  
  for (const envVar of analyticsEnvVars) {
    const value = process.env[envVar]
    const status = value ? '‚úÖ' : '‚ùå'
    console.log(`   ${status} ${envVar}${value ? `=${value}` : ''}`)
  }
  console.log('')
  
  // Check database schema requirements
  console.log('üóÑÔ∏è DATABASE SCHEMA REQUIREMENTS:')
  console.log('   Required tables:')
  console.log('   ‚Ä¢ analytics_events (event tracking)')
  console.log('   ‚Ä¢ user_sessions (session management)')
  console.log('   ‚Ä¢ error_monitoring (error tracking)')
  console.log('   ‚Ä¢ error_statistics (error stats)')
  console.log('   ‚Ä¢ application_logs (application logging)')
  console.log('   ‚Ä¢ log_statistics (log stats)')
  console.log('')
  
  // Analytics recommendations
  console.log('üí° ANALYTICS & LOGGING RECOMMENDATIONS:')
  
  if (!flags.analytics) {
    console.log('   ‚Ä¢ Enable analytics feature flag')
  }
  
  if (!flags.notifications) {
    console.log('   ‚Ä¢ Enable notifications feature flag')
  }
  
  const missingEnvVars = analyticsEnvVars.filter(envVar => !process.env[envVar])
  if (missingEnvVars.length > 0) {
    console.log(`   ‚Ä¢ Set missing environment variables: ${missingEnvVars.join(', ')}`)
  }
  
  console.log('   ‚Ä¢ Set up Google Analytics 4 property')
  console.log('   ‚Ä¢ Configure conversion goals in GA4')
  console.log('   ‚Ä¢ Set up custom dimensions for user properties')
  console.log('   ‚Ä¢ Configure error monitoring alerts')
  console.log('   ‚Ä¢ Set up log aggregation and analysis')
  console.log('   ‚Ä¢ Configure notification channels (Slack, Discord)')
  console.log('   ‚Ä¢ Test analytics tracking with GA4 DebugView')
  console.log('   ‚Ä¢ Verify error monitoring with test errors')
  console.log('   ‚Ä¢ Test logging with different log levels')
  console.log('   ‚Ä¢ Set up log retention policies')
  console.log('   ‚Ä¢ Configure log export functionality')
  console.log('   ‚Ä¢ Test API routes with sample data')
  console.log('   ‚Ä¢ Verify database schema and indexes')
  console.log('   ‚Ä¢ Set up monitoring dashboards')
  console.log('   ‚Ä¢ Configure automated error reporting')
  
  console.log('\n‚úÖ Analytics & Logging system check completed!')
}

// Run the check
checkAnalyticsLoggingSystem().catch(console.error)
